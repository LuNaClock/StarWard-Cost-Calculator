# プロジェクト概要

このドキュメントは、プロジェクト内の各ファイルの役割と構成内容、および考えられる改善点をまとめたものです。

## ファイル構成と役割

*   **`index.html`**: アプリケーションのメインとなるHTMLファイルです。
    *   **構成内容**: HTMLの基本構造、ヘッダー情報（文字コード、ビューポート、CSP、タイトル、外部フォント・ライブラリの読み込み）、メインコンテンツエリア（使い方ガイド、再出撃シミュレーション、チーム合計耐久力予測、キャラクター検索・フィルタリング、キャラクターグリッド）、ローディングオーバーレイ、フッター、GSAPおよびメインJavaScriptファイル (`app.js`) の読み込み。
    *   **モバイルUIの構成**: モバイル版シミュレーター画面にも「チーム合計耐久力予測」と「選択キャラクター詳細」のパネルを設置し、再出撃結果だけでなくチーム全体の耐久評価や選択機体の詳細を一覧できるようにしています。
    *   **役割**: ユーザーインターフェースの骨組みを提供し、必要なリソースを読み込みます。
*   **`style.css`**: アプリケーションのスタイルを定義するCSSファイルです。
    *   **構成内容**: 基本スタイル（フォント、カラーパレット、背景）、各種コンポーネント（タイトル、使い方ガイド、アコーディオン、検索・フィルタリング、キャラクターカード、HPバー、テーブル、ローディングインジケーター、フッター）、シミュレーション関連セクション（再出撃シミュレーション、合計耐久力表示）、レスポンシブデザイン対応のメディアクエリ、アニメーション（キーフレームアニメーション）など。
    *   **役割**: アプリケーションの見た目とレスポンシブ対応を担当します。
*   **`data.js`**: キャラクターデータや定数などを定義するJavaScriptファイルです。
    *   **構成内容**: `rawCharacterData`（キャラクターのHP、コスト、画像パスなどの配列）、`kanjiNameReadings`（漢字名の読み仮名）、`costRemainingMap`（残りコストの組み合わせ）、`MAX_TEAM_COST`（チームコスト上限）、`AVERAGE_GAUGE_COEFFICIENT`（覚醒ゲージ計算係数）、`AWAKENING_THRESHOLD`（覚醒使用可能閾値）、`AWAKENING_BONUS_BY_COST`（コスト別覚醒ボーナス）、`PARTNER_DOWN_AWAKENING_BONUS`（相方撃墜時覚醒ボーナス）。
    *   **役割**: アプリケーションで使用する静的なデータを提供します。
*   **`js/app.js`**: アプリケーションの主要なロジックを記述するJavaScriptファイルです。（※このファイルは提供されていませんが、`index.html`から読み込まれているため存在すると仮定します）
    *   **構成内容 (推定)**: `data.js`から読み込んだデータを用いて、キャラクターカードの動的生成、検索・フィルタリング・ソート機能の実装、HPバーの更新、再出撃シミュレーションの計算ロジック、覚醒ゲージ予測の計算ロジック、チーム合計耐久力予測の計算ロジック、アコーディオンの開閉制御、ローディング表示制御、URL共有機能など。
    *   **役割**: アプリケーションのインタラクティブな動作や計算処理を担当します。
*   **`README.md`**: プロジェクトの概要、機能、実行方法、技術仕様などを記載したドキュメントファイルです。
    *   **構成内容**: プロジェクトタイトル、概要、実行方法、主な機能（コストオーバー計算、表示機能、検索・フィルタリング・ソート、再出撃シミュレーション、覚醒ゲージ予測、チーム合計耐久力予測）、使用方法、技術仕様、将来の拡張可能性、参考資料、著作権情報。
    *   **役割**: プロジェクトの全体像を開発者や利用者に伝えます。
*   **`LICENSE`**: プロジェクトのライセンス情報を記載したファイルです。
    *   **構成内容**: MIT Licenseの全文。
    *   **役割**: ソフトウェアの利用条件を明示します。
*   **`assets/character_icons/`**: キャラクターのアイコン画像が格納されているディレクトリです。（※ファイル一覧にはありませんが、`data.js`内の画像パスから存在すると仮定します）
    *   **構成内容 (推定)**: 各キャラクターに対応する画像ファイル (例: `griffin.webp` など)。
    *   **役割**: キャラクター表示に必要な画像リソースを提供します。

## 考えられる改善点

### 機能面

1.  **データ管理の改善**: `data.js` は現状でも十分機能していますが、キャラクター数が増えたり、より複雑なデータ（武装情報、特殊能力など）を扱うようになると、メンテナンス性が低下する可能性があります。
    *   **提案**: JSONファイルとして外部化し、`fetch API`で読み込むようにする。これにより、データの編集が容易になり、JavaScriptコードと分離できます。あるいは、小規模なデータベース（例: SQLiteをWASM経由で利用、IndexedDBなど）の導入も将来的には考えられます。
2.  **状態管理の導入**: 現在のコードでは、DOM操作やイベントリスナーが複雑に絡み合っている可能性があります（`app.js` の内容を推測）。アプリケーションの状態（選択中のキャラクター、フィルター条件、シミュレーション結果など）を一元管理する仕組みがない場合、コードの見通しが悪くなりがちです。
    *   **提案**: 小規模な状態管理ライブラリ（例: Zustand, Valtioなど）を導入するか、Vanilla JSでシンプルな状態管理パターン（例: Pub/Subパターン）を実装する。これにより、状態の変更とUIの更新が予測可能になり、デバッグも容易になります。
3.  **UI/UXの更なる向上**:
    *   **入力値のバリデーション強化**: `beforeShotdownAwakeningGaugeInput` や `beforeShotdownHpInput` などの入力フィールドで、想定外の値（例: 最大HPを超える値、マイナス値）が入力された場合のフィードバックをより親切にする。
    *   **Undo/Redo機能**: シミュレーション条件の変更を元に戻したり、やり直したりする機能。
    *   **テーマ変更機能**: ライトモード/ダークモードの切り替えなど。
4.  **PWA (Progressive Web App) 化**: オフラインでも利用可能にしたり、ホーム画面に追加できるようにする。
5.  **テストの導入**: JavaScriptのロジック部分（特に計算処理）に対して単体テストを導入し、品質を担保する。
    *   **提案**: JestやVitestのようなテストフレームワークを導入する。

### コード・構成面

1.  **JavaScriptのモジュール化**: `app.js` が大規模化している場合、機能ごとにファイルを分割し、ES Modulesとして適切にインポート/エクスポートすることで、可読性とメンテナンス性を向上させる。
    *   **提案**: 例えば、UI操作関連、計算ロジック関連、データ処理関連などでファイルを分ける。
2.  **CSSの構造化**: `style.css` が非常に長大になっています。より管理しやすくするために、コンポーネントごとやセクションごとにCSSファイルを分割し、ビルドプロセスで結合するか、CSS ModulesやSass/SCSSのようなプリプロセッサの導入を検討する。
    *   **提案**: BEMのような命名規則を徹底するだけでも、ある程度の秩序は保てます。
3.  **パフォーマンス最適化**:
    *   **画像フォーマットの最適化**: キャラクターアイコンをPNGからWebP形式に変換し、ファイルサイズを削減しました。(実施済み)
    *   **画像の遅延読み込み**: `character-grid` 内のキャラクター画像は、画面に表示されるタイミングで読み込むようにする（`loading="lazy"` 属性の活用）。
    *   **DOM操作の最適化**: 大量のキャラクターカードを一度に描画・更新する際のパフォーマンスを考慮し、Virtual DOMの考え方を一部取り入れたり、DocumentFragmentを活用したりする。
4.  **アクセシビリティ (a11y) の向上**: `aria`属性の適切な使用やキーボードナビゲーションの改善など、アクセシビリティをさらに高める余地があります。

### `index.html` に関する具体的な改善提案

*   **GSAPのSRI**: `index.html` 内のGSAPの`<script>`タグに `integrity` 属性がありますが、コメントで「エラーメッセージから取得した正しいものに置き換えてください」とあります。実際に正しいSRIハッシュ値に置き換えるべきです。
*   **フッターの年**: `<footer>`内の年は自動更新されるようにJavaScriptで処理するか、ビルドプロセスで動的に埋め込む方がメンテナンスしやすいでしょう。
*   **CSP (Content Security Policy)**: 現在のCSPは比較的しっかり設定されていますが、`script-src` に `https://cdnjs.cloudflare.com` を許可しているため、GSAP以外のライブラリもCDNから読み込めてしまいます。可能であれば、許可するドメインやパスをより厳密に指定するか、SRIハッシュを全ての外部スクリプトに適用することが望ましいです。

### `style.css` に関する具体的な改善提案

*   **コメントアウトされたセレクタ**: `/* IMPROVEMENT X: ... */` のようなコメントが多く、これが開発中のメモなのか、意図的に無効化されたスタイルなのかが不明確です。完成版では整理するか、コメントの意図を明確に記述すべきです。
*   **重複する可能性のあるスタイル**: `will-change` プロパティが多用されていますが、本当に必要な箇所に限定しないと、逆にパフォーマンスを低下させる可能性があります。各要素のアニメーションやトランジションを精査し、適切に使用箇所を見直すと良いでしょう。
*   **マジックナンバーの削減**: `max-height: 1000px;` のような固定値は、より柔軟な値（例: `auto` やコンテンツに依存する計算値）に置き換えられるか検討する。
*   **セレクタの最適化**: ネストが深すぎるセレクタや、汎用性の低すぎるセレクタは避けるようにし、CSSのパフォーマンスとメンテナンス性を高める。

### `data.js` に関する具体的な改善提案

*   **定数の命名**: `AWAKENING_BONUS_BY_COST` や `PARTNER_DOWN_AWAKENING_BONUS` のキーが `"3.0"` と `"3"` のように文字列と数値が混在しています。どちらかに統一する（例: 文字列 `"3.0"` のみ）方が、参照時の混乱を避けられます。

### `app.js` (JavaScriptロジック) に関する具体的な改善提案 (今回のUI変更に伴うもの)

*   **アコーディオン開閉ロジックの追加**: 新しく追加されたメインセクションのアコーディオン（「再出撃シミュレーション」と「チーム合計耐久力予測」）に対しても、既存の「ツールの使い方ガイド」セクション内のアコーディオンと同様の開閉ロジックを実装する必要があります。
    *   具体的には、`.main-section-accordion-header` クラスを持つボタンがクリックされた際に、対応する `.main-section-accordion-content` の `max-height`, `opacity`, `transform`, `padding` を変更し、`aria-expanded` 属性とアイコンの向き (`.accordion-icon`) を更新する処理が必要です。
    *   初期状態で開いているアコーディオン (`aria-expanded="true"`, `main-section-accordion-content` に `show` クラスが付与されているもの) の挙動も考慮に入れる必要があります。
*   **動的コンテンツ表示との連携**: 「再出撃シミュレーション」や「チーム合計耐久力予測」の結果が表示される際（例: `simulationResults.active` や `totalHpDisplayArea.active` クラスが付与される時）、もしアコーディオンが閉じられていたら、自動で開く、あるいはユーザーに通知するなどのUXを検討する必要があるかもしれません。現状では `show` クラスで初期表示時にコンテンツ部分も表示されるようにしていますが、インタラクションによっては動的な制御が求められる場合があります。

これらの改善提案は、プロジェクトの現在の規模や目的、将来の拡張計画によって優先順位が変わります。 